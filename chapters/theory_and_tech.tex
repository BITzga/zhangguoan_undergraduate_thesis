%%
% The BIThesis Template for Bachelor Graduation Thesis
%
% 北京理工大学毕业设计（论文）第一章节 —— 使用 XeLaTeX 编译
%
% Copyright 2020-2021 BITNP
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3
% of this license or (at your option) any later version.
% The latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3 or later is part of all distributions of LaTeX
% version 2005/12/01 or later.
%
% This work has the LPPL maintenance status `maintained'.
%
% The Current Maintainer of this work is Feng Kaiyu.
%
% 第二章

\chapter{理论基础及相关技术}

\section{代理内核操作系统实验}

\subsection{代理内核的概念}

代理内核(Proxy Kernel)是一种特殊的操作系统内核。
代理内核系统是由代理内核和Host主机的操作系统Ubuntu组成的。
代理内核与Host主机的操作系统之间使用HTIF接口进行通信。

代理内核并不是一个独立的操作系统，它虽然拥有IO功能，但它不具备IO的独立实现。
它的IO功能实现依赖于Host主机的操作系统Ubuntu。
也就是说，代理内核Proxy Kernel与Host主机的操作系统Ubuntu是并行在运行的。
它们之间通过HTIF(Host Target Interface)通信。
当代理内核需要进行IO时，代理内核就通过HTIF调用Host主机的操作系统Ubuntu的IO接口，以达到IO的目的。

\subsection{代理内核的思想}

代理内核是操作系统的最小集。
它只关心内存和CPU的管理，不关心外部设备IO功能的实现。
代理内核的IO功能都代理给Host主机的操作系统Ubuntu。
这样做的好处是，开发者不必在拘泥于繁琐的外部设备的IO实现，
而是将注意力集中于计算机的核心资产CPU、内存等。

除此之外，因为代理内核少了具体的IO实现，代理内核的代码会变得加更精简。
精简的代理内核代码更便于维护，也更便于后续学习者学习。

代理内核还有助于我们快速验证CPU软核。由于代理内核只关心CPU的管理，内存的管理。
这么一来，我们就可以将代理内核运行在更加独立的RISC-V CPU软核上，该CPU软核不需要实现IO功能。
我们也可以更加集中精力去验证CPU软核的功能。从而进行快速的迭代和开发。
在真实的物理环境Zedboard开发板上，
代理内核的代码会被编译成RISC-V指令，
最终运行在FPGA上的RISC-V CPU软核上。
与此同时，Zedboard开发板上的ARM物理核运行着ARM版本的Ubuntu操作系统。
代理内核通过Zedboard上的HTIF接口调用Ubuntu操作系统的IO接口。
这种设计下，我们不需要实现CPU的IO功能，我们可以快速对RISC-V CPU软核进行验证。

\subsection{代理内核实验的基本介绍}

代理内核实验PKE主要分为三个部分:
a.系统调用、异常处理、时钟中断，b.内存管理，c.进程管理。
后面的实验对前面的实验具有依赖关系，如果前面的实验没有完成，后面的实验就不能进行。
每个实验都具有用户态程序、内核态程序。
实验操作者需要根据用户态程序的需求，补全内核代码。
只有这样，代理内核自身和用户程序才能正常运行。

代理内核实验PKE的每个小实验都较为精简紧凑。
对于实验操作者来说，在梳理好每个实验执行流程之后，就可以很容易对实验代码进行补全。
实验代码短小精悍，行数虽然少，但是代码的意义却很大。
它可以帮助实验操作者集中精力于管理计算机的内存、CPU，帮助实验操作者快速验证操作系统的理论知识。


\section{RISC-V新型开放指令集和精简指令集介绍}

\subsection{RISC-V的基本介绍}

RISC-V指令集是一种新型的开放和精简指令集。
它通过取长补短的方式，吸取了以往CPU指令集的优点、避免了以往CPU指令集的大部分缺点。

它是一个基于开放架构的指令集，RISC-V的指令是开放的，任何人都可以根据这个开放的指令集去实现RISC-V架构的CPU。
因此，RISC-V指令集具有开源、免费的特点。

它是一个精简的指令集。RISC-V手册指出，
同样的C语言程序，经过适用于不同CPU架构的编译器编译后，
得到的指令序列中，RISC-V架构的指令是相对来说数量较少、较精简的。
这对减少嵌入式设备功耗具有重要的意义。

\subsection{RISC-V的特权级}

\subsection{RISC-V的中断、异常委托}

\section{现有K210板子内核移植工作的参考}

\subsection{K210的基本信息}

\subsection{THU uCore的移植过程}

\subsection{MIT xv6的移植过程}

